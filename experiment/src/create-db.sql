USE DBEXP;

-- 用户表
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='USERS' and xtype='U') BEGIN
	CREATE TABLE USERS (
		UID		INTEGER			NOT NULL,	-- 用户ID
		NAME	VARCHAR(64)		NOT NULL,	-- 姓名
		SEX		CHAR(2),					-- 性别
		BYEAR	INT,						-- 出生年份
		CITY	VARCHAR(64),				-- 所在城市
		PRIMARY KEY (UID),
	)
END

-- 分类表
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='LABEL' AND xtype='U') BEGIN
	CREATE TABLE LABEL (
		LID		INTEGER			NOT NULL,	-- 分类ID
		LNAME	VARCHAR(128)	NOT NULL,	-- 分类名称
		PRIMARY	KEY (LID),
	)
END

-- 博文表
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='MBLOG' AND xtype='U') BEGIN
	CREATE TABLE MBLOG (
		BID		INTEGER			NOT NULL,	-- 博文ID
		TITLE	VARCHAR(512)	NOT NULL,	-- 标题
		UID		INTEGER			NOT NULL,	-- 用户ID
		PYEAR	INTEGER			NOT NULL,	-- 年
		PMONTH	INTEGER			NOT NULL,	-- 月
		PDAY	INTEGER			NOT NULL,	-- 日
		CONT	TEXT			NOT NULL,	-- 正文
		PRIMARY KEY (BID),
		FOREIGN KEY (UID) REFERENCES USERS,
	)
END

-- 博文标注
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='B_L' AND xtype='U') BEGIN
	CREATE TABLE B_L (
		BID		INTEGER		NOT NULL,	-- 博文ID
		LID		INTEGER		NOT NULL,	-- 分类ID
		PRIMARY KEY (BID, LID),
		FOREIGN KEY (BID) REFERENCES MBLOG,
		FOREIGN KEY (LID) REFERENCES LABEL,
	)
END

-- 关注
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='FOLLOW' AND xtype='U') BEGIN
	CREATE TABLE FOLLOW (
		UID		INTEGER		NOT NULL,	-- 用户ID
		UIDFLED	INTEGER		NOT NULL,	-- 被关注用户ID
		PRIMARY KEY (UID, UIDFLED),
		FOREIGN KEY (UID) REFERENCES USERS,
		FOREIGN KEY (UIDFLED) REFERENCES USERS,
	)
END

-- 好友
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='FRIENDS' AND xtype='U') BEGIN
	CREATE TABLE FRIENDS (
		UID		INTEGER		NOT NULL,	-- 用户ID
		FUID	INTEGER		NOT NULL,	-- 好友ID
		PRIMARY KEY (UID, FUID),
		FOREIGN KEY (UID) REFERENCES USERS,
		FOREIGN KEY (FUID) REFERENCES USERS,
	)
END

-- 订阅
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='SUB' AND xtype='U') BEGIN
	CREATE TABLE SUB (
		UID		INTEGER		NOT NULL,	-- 用户ID
		LID		INTEGER		NOT NULL,	-- 订阅分类ID
		PRIMARY KEY (UID, LID),
		FOREIGN KEY (UID) REFERENCES USERS,
		FOREIGN KEY (LID) REFERENCES LABEL,
	)
END

-- 点赞
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='THUMB' AND xtype='U') BEGIN
	CREATE TABLE THUMB (
		UID		INTEGER		NOT NULL,	-- 用户ID
		BID		INTEGER		NOT NULL,	-- 博文ID
		PRIMARY KEY (UID, BID),
		FOREIGN KEY (UID) REFERENCES USERS,
		FOREIGN KEY (BID) REFERENCES MBLOG,
	)
END

-- 头条
IF NOT EXISTS (SELECT * FROM sysobjects WHERE name='TOPDAY' AND xtype='U') BEGIN
	CREATE TABLE TOPDAY (
		TYEAR	INTEGER		NOT NULL,	-- 年
		TMONTH	INTEGER		NOT NULL,	-- 月
		TDAY	INTEGER		NOT NULL,	-- 日
		BID		INTEGER		NOT NULL,	-- 博文ID
		TNO		INTEGER		NOT NULL,	-- 顺序号
		PRIMARY KEY (TYEAR, TMONTH, TDAY, TNO),
		FOREIGN KEY (BID) REFERENCES MBLOG,
	)
END